# file opened: test.asm
 1    0000
 2    0000                 DEVICE ZXSPECTRUM48
 3    0000                 org $8000
 4    8000
 5    8000              start:
 6    8000 C3 24 80        jp main_code
 7    8003
 8    8003              ; Character Codes
 9    8003              ENTER       equ $0D
10    8003
11    8003              ; ROM routines
12    8003              ROM_CLS     equ $0DAF
13    8003              ROM_PRINT   equ $203C
14    8003
15    8003              ; DATA
16    8003
17    8003 41 53 4D 20  hello:		db "ASM prototype file for SjASMPlus",ENTER
17    8007 70 72 6F 74
17    800B 6F 74 79 70
17    800F 65 20 66 69
17    8013 6C 65 20 66
17    8017 6F 72 20 53
17    801B 6A 41 53 4D
17    801F 50 6C 75 73
17    8023 0D
18    8024              HELLO_LEN   equ $ - hello
19    8024
20    8024              main_code:
21    8024 CD AF 0D        call ROM_CLS
22    8027 11 03 80        ld de,hello
23    802A 01 21 00        ld bc,HELLO_LEN
24    802D CD 3C 20        call ROM_PRINT
25    8030 C9              ret
26    8031
27    8031              ; Deployment
28    8031              LENGTH      equ $ - start
29    8031
30    8031
31    8031                 ;;   Cette partie est gérée par TapLib.asm
32    8031                 include TapLib.asm
# file opened: TapLib.asm
 1+   8031              ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 2+   8031              ;; Busy soft ;; 26.11.2018 ;; Tape generating library ;;
 3+   8031              ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 4+   8031
 5+   8031              ;; Use:
 6+   8031              ;;
 7+   8031              ;;   .................
 8+   8031              ;;   ...your...code...
 9+   8031              ;;   .................
10+   8031              ;;   include "TapLib.asm"
11+   8031              ;;   MakeTape <speccy_model>, <tape_file>, <program_name>, <start_address>, <code_length>, <call_address>
12+   8031
13+   8031              	MACRO	MakeTape speccy_model, tape_file, prog_name, start_add, code_len, call_add
14+   8031 ~            	DEVICE	speccy_model
15+   8031 ~
16+   8031 ~            CODE	=	#AF
17+   8031 ~            USR	=	#C0
18+   8031 ~            LOAD	=	#EF
19+   8031 ~            CLEAR	=	#FD
20+   8031 ~            RANDOMIZE =	#F9
21+   8031 ~
22+   8031 ~            	org	#5C00
23+   8031 ~            baszac	db	0,1			;; Line number
24+   8031 ~            	dw	linlen			;; Line length
25+   8031 ~            linzac
26+   8031 ~            	db	CLEAR,'8',#0E,0,0
27+   8031 ~            	dw	start_add-1
28+   8031 ~            	db	0,':'
29+   8031 ~            	db	LOAD,'"'
30+   8031 ~            codnam	ds	10,32
31+   8031 ~            	org	codnam
32+   8031 ~            	db	prog_name
33+   8031 ~            	org	codnam+10
34+   8031 ~            	db	'"',CODE,':'
35+   8031 ~            	db	RANDOMIZE,USR,'8',#0E,0,0
36+   8031 ~            	dw	call_add
37+   8031 ~            	db	0,#0D
38+   8031 ~            linlen	=	$-linzac
39+   8031 ~            baslen	=	$-baszac
40+   8031 ~
41+   8031 ~            	EMPTYTAP tape_file
42+   8031 ~            	SAVETAP  tape_file,BASIC,prog_name,baszac,baslen,1
43+   8031 ~            	SAVETAP  tape_file,CODE,prog_name,start_add,code_len,start_add
44+   8031 ~
45+   8031              	ENDM
46+   8031
# file closed: TapLib.asm
33    8031                 ;;   MakeTape <speccy_model>, <tape_file>, <program_name>, <start_address>, <code_length>, <call_address>
34    8031
35    8031                 ; option 1: tape
36    8031                 MakeTape ZXSPECTRUM48, "_tape.tap", "tapefile", start, LENGTH, start
36    8031             >	DEVICE	ZXSPECTRUM48
36    8031             >
36    8031             >CODE	=	#AF
36    8031             >USR	=	#C0
36    8031             >LOAD	=	#EF
36    8031             >CLEAR	=	#FD
36    8031             >RANDOMIZE =	#F9
36    8031             >
36    8031             >	org	#5C00
36    5C00 00 01       >baszac	db	0,1			;; Line number
36    5C02 22 00       >	dw	linlen			;; Line length
36    5C04             >linzac
36    5C04 FD 38 0E 00 >	db	CLEAR,'8',#0E,0,0
36    5C08 00          >
36    5C09 FF 7F       >	dw	start-1
36    5C0B 00 3A       >	db	0,':'
36    5C0D EF 22       >	db	LOAD,'"'
36    5C0F 20 20 20... >codnam	ds	10,32
36    5C19             >	org	codnam
36    5C0F 74 61 70 65 >	db	"tapefile"
36    5C13 66 69 6C 65 >
36    5C17             >	org	codnam+10
36    5C19 22 AF 3A    >	db	'"',CODE,':'
36    5C1C F9 C0 38 0E >	db	RANDOMIZE,USR,'8',#0E,0,0
36    5C20 00 00       >
36    5C22 00 80       >	dw	start
36    5C24 00 0D       >	db	0,#0D
36    5C26             >linlen	=	$-linzac
36    5C26             >baslen	=	$-baszac
36    5C26             >
36    5C26             >	EMPTYTAP "_tape.tap"
36    5C26             >	SAVETAP  "_tape.tap",BASIC,"tapefile",baszac,baslen,1
36    5C26             >	SAVETAP  "_tape.tap",CODE,"tapefile",start,LENGTH,start
36    5C26             >
37    5C26
38    5C26                 ; option 2: snapshot
39    5C26                 SAVESNA "_snapshot.sna", start
# file closed: test.asm
